<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AuthSite</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_AuthSite.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/AuthSite.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">Snowdrift-0.1.4: Infrastructure for the Snowdrift.coop fundraising site.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>License</th><td>AGPL-3</td></tr><tr><th>Maintainer</th><td>dev@lists.snowdrift.coop</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">AuthSite</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Subsite interface</a><ul><li><a href="#g:2">Integration with your site</a></li><li><a href="#g:3">Routes</a></li><li><a href="#g:4">Querying auth status</a></li><li><a href="#g:5">Helper for writing handlers</a></li></ul></li><li><a href="#g:6">Types</a></li><li><a href="#g:7">Internals</a><ul><li><a href="#g:8"><code>persistent</code>-generated types</a></li></ul></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Subsite for email-and-passphrase authentication.</p><p>Quickstart:</p><ol><li>Add <code><a href="AuthSite.html#t:AuthSite">AuthSite</a></code> as a subsite to your routes somewhere.</li><li>Mappend <code><a href="AuthSite.html#v:migrateAuth">migrateAuth</a></code> to your site's <code><a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:Migration">Migration</a></code> when running migrations.</li><li>Have your site datatype instantiate <code><a href="AuthSite.html#t:AuthMaster">AuthMaster</a></code> (this is the hard part).</li></ol></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:AuthSite">AuthSite</a> = <a href="#v:AuthSite">AuthSite</a></li><li class="src short"><a href="#v:migrateAuth">migrateAuth</a> :: <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:Migration">Migration</a></li><li class="src short"><span class="keyword">class</span> <a href="#t:AuthMaster">AuthMaster</a> master <span class="keyword">where</span><ul class="subs"><li><a href="#v:postLoginRoute">postLoginRoute</a> :: master -&gt; <a href="AuthSite.html#t:Route">Route</a> master</li><li><a href="#v:postLogoutRoute">postLogoutRoute</a> :: master -&gt; <a href="AuthSite.html#t:Route">Route</a> master</li><li><a href="#v:loginHandler">loginHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a></li><li><a href="#v:createAccountHandler">createAccountHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a></li><li><a href="#v:resetPassphraseHandler">resetPassphraseHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a></li><li><a href="#v:verifyAccountHandler">verifyAccountHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a></li><li><a href="#v:sendAuthEmail">sendAuthEmail</a> :: <a href="AuthSite.html#t:AuthMailMessage">AuthMailMessage</a> -&gt; <a href="AuthSite.html#t:AuthEmail">AuthEmail</a> -&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:AuthUser">AuthUser</a> = <a href="../persistent-2.2.4.1/Database-Persist-Types.html#t:Entity">Entity</a> <a href="Model.html#t:User">User</a></li><li class="src short"><span class="keyword">data family</span> <a href="#t:Route">Route</a> a</li><li class="src short"><a href="#v:maybeAuth">maybeAuth</a> :: (<a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersist">YesodPersist</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersistBackend">YesodPersistBackend</a> m ~ <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> m <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="AuthSite.html#t:AuthUser">AuthUser</a>)</li><li class="src short"><a href="#v:requireAuth">requireAuth</a> :: (<a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersist">YesodPersist</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersistBackend">YesodPersistBackend</a> m ~ <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> m <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="AuthSite.html#t:AuthUser">AuthUser</a></li><li class="src short"><a href="#v:credentialsForm">credentialsForm</a> :: (<a href="../shakespeare-2.0.8/Text-Shakespeare-I18N.html#t:RenderMessage">RenderMessage</a> (<a href="../yesod-core-1.4.20/Yesod-Core.html#t:HandlerSite">HandlerSite</a> m) <a href="../yesod-form-1.4.7/Yesod-Form-Types.html#t:FormMessage">FormMessage</a>, <a href="../yesod-core-1.4.20/Yesod-Core.html#t:MonadHandler">MonadHandler</a> m) =&gt; <a href="../yesod-form-1.4.7/Yesod-Form-Types.html#t:AForm">AForm</a> m <a href="AuthSite.html#t:Credentials">Credentials</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Credentials">Credentials</a> = <a href="#v:Credentials">Credentials</a> {<ul class="subs"><li><a href="#v:credsIdent">credsIdent</a> :: <a href="AuthSite.html#t:AuthEmail">AuthEmail</a></li><li><a href="#v:credsPass">credsPass</a> :: <a href="AuthSite.html#t:ClearPassphrase">ClearPassphrase</a></li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:AuthEmail">AuthEmail</a> = <a href="#v:AuthEmail">AuthEmail</a> {<ul class="subs"><li><a href="#v:fromAuth">fromAuth</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:ClearPassphrase">ClearPassphrase</a> = <a href="#v:ClearPassphrase">ClearPassphrase</a> {<ul class="subs"><li><a href="#v:fromClear">fromClear</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:AuthMailMessage">AuthMailMessage</a><ul class="subs"><li>= <a href="#v:VerifyUserCreation">VerifyUserCreation</a> <a href="AuthSite.html#t:AuthToken">AuthToken</a></li><li>| <a href="#v:VerifyPassReset">VerifyPassReset</a> <a href="AuthSite.html#t:AuthToken">AuthToken</a></li><li>| <a href="#v:BadUserCreation">BadUserCreation</a></li><li>| <a href="#v:BadPassReset">BadPassReset</a></li></ul></li><li class="src short"><span class="keyword">newtype</span> <a href="#t:AuthToken">AuthToken</a> = <a href="#v:AuthToken">AuthToken</a> {<ul class="subs"><li><a href="#v:fromAuthToken">fromAuthToken</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li></ul>}</li><li class="src short"><a href="#v:provisional">provisional</a> :: <a href="AuthSite.html#t:Credentials">Credentials</a> -&gt; <a href="AuthSite.html#t:Verification">Verification</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></li><li class="src short"><a href="#v:logout">logout</a> :: <a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> master =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:priviligedProvisionalUser">priviligedProvisionalUser</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:MonadIO">MonadIO</a> m =&gt; <a href="AuthSite.html#t:Credentials">Credentials</a> -&gt; <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlPersistT">SqlPersistT</a> m <a href="AuthSite.html#t:Verification">Verification</a></li><li class="src short"><a href="#v:privilegedCreateUser">privilegedCreateUser</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:MonadIO">MonadIO</a> m =&gt; <a href="AuthSite.html#t:VerifiedUser">VerifiedUser</a> -&gt; <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlPersistT">SqlPersistT</a> m ()</li><li class="src short"><a href="#v:priviligedLogin">priviligedLogin</a> :: <a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> master =&gt; <a href="AuthSite.html#t:AuthUser">AuthUser</a> -&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:VerifiedUser">VerifiedUser</a> = <a href="#v:VerifiedUser">VerifiedUser</a> {<ul class="subs"><li><a href="#v:verifiedEmail">verifiedEmail</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li><li><a href="#v:verifiedDigest">verifiedDigest</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:ByteString">ByteString</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Verification">Verification</a> = <a href="#v:Verification">Verification</a> {<ul class="subs"><li><a href="#v:verifyEmail">verifyEmail</a> :: <a href="AuthSite.html#t:AuthEmail">AuthEmail</a></li><li><a href="#v:verifyToken">verifyToken</a> :: <a href="AuthSite.html#t:AuthToken">AuthToken</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:ProvisionalUser">ProvisionalUser</a> = <a href="#v:ProvisionalUser">ProvisionalUser</a> {<ul class="subs"><li><a href="#v:provisionalUserEmail">provisionalUserEmail</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li><li><a href="#v:provisionalUserDigest">provisionalUserDigest</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:ByteString">ByteString</a></li><li><a href="#v:provisionalUserToken">provisionalUserToken</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li><li><a href="#v:provisionalUserCreationTime">provisionalUserCreationTime</a> :: !<a href="../time-1.5.0.1/Data-Time-Clock.html#t:UTCTime">UTCTime</a></li></ul>}</li></ul></div><div id="interface"><h1 id="g:1">Subsite interface</h1><h2 id="g:2">Integration with your site</h2><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:AuthSite" class="def">AuthSite</a> <a href="src/AuthSiteTypes.html#AuthSite" class="link">Source</a></p><div class="doc"><p>Foundation type for the subsite.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AuthSite" class="def">AuthSite</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:AuthSite" class="caption collapser" onclick="toggleSection('i:AuthSite')">Instances</p><div id="section.i:AuthSite" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../yesod-core-1.4.20/Yesod-Core.html#t:RenderRoute">RenderRoute</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a></span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../yesod-core-1.4.20/Yesod-Core.html#t:ParseRoute">ParseRoute</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a></span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../yesod-core-1.4.20/Yesod-Core.html#t:RouteAttrs">RouteAttrs</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a></span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a> <ul class="inst"><li class="inst">= <a name="v:LoginR" class="def">LoginR</a></li><li class="inst">| <a name="v:LogoutR" class="def">LogoutR</a></li><li class="inst">| <a name="v:CreateAccountR" class="def">CreateAccountR</a></li><li class="inst">| <a name="v:VerifyAccountR" class="def">VerifyAccountR</a></li><li class="inst">| <a name="v:ResetPassphraseR" class="def">ResetPassphraseR</a></li></ul></span> <a href="src/AuthSiteTypes.html#line-14" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:migrateAuth" class="def">migrateAuth</a> :: <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:Migration">Migration</a> <a href="src/AuthSiteTypes.html#migrateAuth" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">class</span> <a name="t:AuthMaster" class="def">AuthMaster</a> master <span class="keyword">where</span> <a href="src/AuthSite.html#AuthMaster" class="link">Source</a></p><div class="doc"><p>Any site that uses this subsite needs to instantiate this class.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:postLoginRoute" class="def">postLoginRoute</a> :: master -&gt; <a href="AuthSite.html#t:Route">Route</a> master <a href="src/AuthSite.html#postLoginRoute" class="link">Source</a></p><div class="doc"><p>Where to go after login</p></div><p class="src"><a name="v:postLogoutRoute" class="def">postLogoutRoute</a> :: master -&gt; <a href="AuthSite.html#t:Route">Route</a> master <a href="src/AuthSite.html#postLogoutRoute" class="link">Source</a></p><div class="doc"><p>Where to go after logout</p></div><p class="src"><a name="v:loginHandler" class="def">loginHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a> <a href="src/AuthSite.html#loginHandler" class="link">Source</a></p><div class="doc"><p>What to show on the login page. This page should have a form that posts
 <code><a href="AuthSite.html#t:Credentials">Credentials</a></code> to 'Route LoginR'. See <code>AuthHarness</code> in the tests for a
 simplistic example.</p></div><p class="src"><a name="v:createAccountHandler" class="def">createAccountHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a> <a href="src/AuthSite.html#createAccountHandler" class="link">Source</a></p><div class="doc"><p>What to show on the create-account page. This page should post
 <code><a href="AuthSite.html#t:Credentials">Credentials</a></code> to <code>CreateAccountR</code>.</p></div><p class="src"><a name="v:resetPassphraseHandler" class="def">resetPassphraseHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a> <a href="src/AuthSite.html#resetPassphraseHandler" class="link">Source</a></p><div class="doc"><p>What to show on the reset-passphrase page. This page should post
 <code><a href="AuthSite.html#t:Credentials">Credentials</a></code> to <code>ResetPassphraseR</code></p></div><p class="src"><a name="v:verifyAccountHandler" class="def">verifyAccountHandler</a> :: <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:TypedContent">TypedContent</a> <a href="src/AuthSite.html#verifyAccountHandler" class="link">Source</a></p><div class="doc"><p>What to show on the verify-account page. This page should post
 <code><a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></code> (the token) to <code>VerifyAccountR</code></p></div><p class="src"><a name="v:sendAuthEmail" class="def">sendAuthEmail</a> :: <a href="AuthSite.html#t:AuthMailMessage">AuthMailMessage</a> -&gt; <a href="AuthSite.html#t:AuthEmail">AuthEmail</a> -&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/AuthSite.html#sendAuthEmail" class="link">Source</a></p><div class="doc"><p>This module sends emails, in case that wasn't obvious.
 <a href="../mime-mail-0.4.11/Network-Mail-Mime.html">Network.Mail.Mime</a> or <a href="Network-Mail-Mime-SES.html">Network.Mail.Mime.SES</a> have good options for
 this method.</p></div></div><div class="subs instances"><p id="control.i:AuthMaster" class="caption collapser" onclick="toggleSection('i:AuthMaster')">Instances</p><div id="section.i:AuthMaster" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="AuthSite.html#t:AuthMaster">AuthMaster</a> <a href="Foundation.html#t:App">App</a></span> <a href="src/AuthSite.html#line-131" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:AuthUser" class="def">AuthUser</a> = <a href="../persistent-2.2.4.1/Database-Persist-Types.html#t:Entity">Entity</a> <a href="Model.html#t:User">User</a> <a href="src/AuthSite.html#AuthUser" class="link">Source</a></p><div class="doc"><p>This is a cheapo synonym. Eventually AuthUser should be part of the
 <code><a href="AuthSite.html#t:AuthMaster">AuthMaster</a></code> interface, for this module to be usable outside of
 Snowdrift.</p></div></div><h2 id="g:3">Routes</h2><div class="doc"><p>Haddock seems to dump the entire <code><a href="AuthSite.html#t:Route">Route</a></code> definition, even
 though the only interesting thing here is the AuthSite instance
 with LoginR, LogoutR, CreateAccountR, VerifyAccountR, and
 ResetPassphraseR.</p></div><div class="top"><p class="src"><span class="keyword">data family</span> <a name="t:Route" class="def">Route</a> a</p><div class="doc"><p>The <a href="http://www.yesodweb.com/book/routing-and-handlers">type-safe URLs</a> associated with a site argument.</p></div><div class="subs instances"><p id="control.i:Route" class="caption collapser" onclick="toggleSection('i:Route')">Instances</p><div id="section.i:Route" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../yesod-core-1.4.20/Yesod-Core-Handler.html#t:RedirectUrl">RedirectUrl</a> master (<a href="AuthSite.html#t:Route">Route</a> master)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">((~) * key <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>, (~) * val <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Handler.html#t:RedirectUrl">RedirectUrl</a> master (<a href="AuthSite.html#t:Route">Route</a> master, [(key, val)])</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">((~) * key <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>, (~) * val <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Handler.html#t:RedirectUrl">RedirectUrl</a> master (<a href="AuthSite.html#t:Route">Route</a> master, <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Map">Map</a> key val)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-static-1.5.0.3/Yesod-Static.html#t:Static">Static</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core.html#t:LiteApp">LiteApp</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:WaiSubsite">WaiSubsite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-gitrev-0.1.0.0/Yesod-GitRev.html#t:GitRev">GitRev</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="Foundation.html#t:App">App</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Ord.html#t:Ord">Ord</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core.html#t:LiteApp">LiteApp</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Ord.html#t:Ord">Ord</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:WaiSubsite">WaiSubsite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-static-1.5.0.3/Yesod-Static.html#t:Static">Static</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core.html#t:LiteApp">LiteApp</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:WaiSubsite">WaiSubsite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-gitrev-0.1.0.0/Yesod-GitRev.html#t:GitRev">GitRev</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="Foundation.html#t:App">App</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-static-1.5.0.3/Yesod-Static.html#t:Static">Static</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core.html#t:LiteApp">LiteApp</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:WaiSubsite">WaiSubsite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-gitrev-0.1.0.0/Yesod-GitRev.html#t:GitRev">GitRev</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="Foundation.html#t:App">App</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-static-1.5.0.3/Yesod-Static.html#t:Static">Static</a> = <a name="v:StaticRoute" class="def">StaticRoute</a> [<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>] [(<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>, <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>)]</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core.html#t:LiteApp">LiteApp</a> = <a name="v:LiteAppRoute" class="def">LiteAppRoute</a> [<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>]</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:WaiSubsite">WaiSubsite</a> = <a name="v:WaiSubsiteRoute" class="def">WaiSubsiteRoute</a> [<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>] [(<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>, <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a>)]</span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-gitrev-0.1.0.0/Yesod-GitRev.html#t:GitRev">GitRev</a> = <a name="v:GitRevR" class="def">GitRevR</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a> <ul class="inst"><li class="inst">= <a name="v:LoginR" class="def">LoginR</a></li><li class="inst">| <a name="v:LogoutR" class="def">LogoutR</a></li><li class="inst">| <a name="v:CreateAccountR" class="def">CreateAccountR</a></li><li class="inst">| <a name="v:VerifyAccountR" class="def">VerifyAccountR</a></li><li class="inst">| <a name="v:ResetPassphraseR" class="def">ResetPassphraseR</a></li></ul></span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="AuthSite.html#t:Route">Route</a> <a href="Foundation.html#t:App">App</a> <ul class="inst"><li class="inst">= <a name="v:StaticR" class="def">StaticR</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-static-1.5.0.3/Yesod-Static.html#t:Static">Static</a>)</li><li class="inst">| <a name="v:AuthR" class="def">AuthR</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="AuthSite.html#t:AuthSite">AuthSite</a>)</li><li class="inst">| <a name="v:GitRevR" class="def">GitRevR</a> (<a href="AuthSite.html#t:Route">Route</a> <a href="../yesod-gitrev-0.1.0.0/Yesod-GitRev.html#t:GitRev">GitRev</a>)</li><li class="inst">| <a name="v:FaviconR" class="def">FaviconR</a></li><li class="inst">| <a name="v:RobotsR" class="def">RobotsR</a></li><li class="inst">| <a name="v:HomeR" class="def">HomeR</a></li><li class="inst">| <a name="v:WelcomeR" class="def">WelcomeR</a></li><li class="inst">| <a name="v:DashboardR" class="def">DashboardR</a></li><li class="inst">| <a name="v:HowItWorksR" class="def">HowItWorksR</a></li><li class="inst">| <a name="v:PrivacyR" class="def">PrivacyR</a></li><li class="inst">| <a name="v:TermsR" class="def">TermsR</a></li><li class="inst">| <a name="v:SearchR" class="def">SearchR</a></li><li class="inst">| <a name="v:ProjectsR" class="def">ProjectsR</a></li><li class="inst">| <a name="v:AboutR" class="def">AboutR</a></li><li class="inst">| <a name="v:TrademarksR" class="def">TrademarksR</a></li><li class="inst">| <a name="v:SponsorsR" class="def">SponsorsR</a></li><li class="inst">| <a name="v:JsLicensesR" class="def">JsLicensesR</a></li><li class="inst">| <a name="v:DonateR" class="def">DonateR</a></li><li class="inst">| <a name="v:MerchandiseR" class="def">MerchandiseR</a></li><li class="inst">| <a name="v:SnowdriftProjectR" class="def">SnowdriftProjectR</a></li><li class="inst">| <a name="v:SnowdriftWikiSearchR" class="def">SnowdriftWikiSearchR</a> <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li></ul></span></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h2 id="g:4">Querying auth status</h2><div class="doc"><p>Duplicating the <a href="../yesod-auth-1.4.13/Yesod-Auth.html">Yesod.Auth</a> interface</p></div><div class="top"><p class="src"><a name="v:maybeAuth" class="def">maybeAuth</a> :: (<a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersist">YesodPersist</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersistBackend">YesodPersistBackend</a> m ~ <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> m <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="AuthSite.html#t:AuthUser">AuthUser</a>) <a href="src/AuthSite.html#maybeAuth" class="link">Source</a></p><div class="doc"><p>If the user is authenticated, get the corresponding Entity.</p></div></div><div class="top"><p class="src"><a name="v:requireAuth" class="def">requireAuth</a> :: (<a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersist">YesodPersist</a> m, <a href="../yesod-persistent-1.4.0.4/Yesod-Persist-Core.html#t:YesodPersistBackend">YesodPersistBackend</a> m ~ <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a>) =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> m <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="AuthSite.html#t:AuthUser">AuthUser</a> <a href="src/AuthSite.html#requireAuth" class="link">Source</a></p><div class="doc"><p>If the user is <em>not</em> authenticated, this will cause a redirect to your
 site's <code><a href="../yesod-core-1.4.20/Yesod-Core.html#v:authRoute">authRoute</a></code> or simply return <code><a href="../yesod-core-1.4.20/Yesod-Core-Handler.html#v:notAuthenticated">notAuthenticated</a></code>.</p><p>Note that <a href="../yesod-auth-1.4.13/Yesod-Auth.html">Yesod.Auth</a> is smarter about not redirecting during an API
 request, but we don't support that yet.</p></div></div><h2 id="g:5">Helper for writing handlers</h2><div class="top"><p class="src"><a name="v:credentialsForm" class="def">credentialsForm</a> :: (<a href="../shakespeare-2.0.8/Text-Shakespeare-I18N.html#t:RenderMessage">RenderMessage</a> (<a href="../yesod-core-1.4.20/Yesod-Core.html#t:HandlerSite">HandlerSite</a> m) <a href="../yesod-form-1.4.7/Yesod-Form-Types.html#t:FormMessage">FormMessage</a>, <a href="../yesod-core-1.4.20/Yesod-Core.html#t:MonadHandler">MonadHandler</a> m) =&gt; <a href="../yesod-form-1.4.7/Yesod-Form-Types.html#t:AForm">AForm</a> m <a href="AuthSite.html#t:Credentials">Credentials</a> <a href="src/AuthSite.html#credentialsForm" class="link">Source</a></p><div class="doc"><p>A decent default form for <code><a href="AuthSite.html#t:Credentials">Credentials</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Credentials" class="def">Credentials</a> <a href="src/AuthSite.html#Credentials" class="link">Source</a></p><div class="doc"><p>The &quot;email and passphrase&quot; representing the main purpose of this
 module.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Credentials" class="def">Credentials</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:credsIdent" class="def">credsIdent</a> :: <a href="AuthSite.html#t:AuthEmail">AuthEmail</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:credsPass" class="def">credsPass</a> :: <a href="AuthSite.html#t:ClearPassphrase">ClearPassphrase</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Credentials" class="caption collapser" onclick="toggleSection('i:Credentials')">Instances</p><div id="section.i:Credentials" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:Credentials">Credentials</a></span> <a href="src/AuthSite.html#line-153" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:AuthEmail" class="def">AuthEmail</a> <a href="src/AuthSite.html#AuthEmail" class="link">Source</a></p><div class="doc"><p>Sanity-preserving type</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AuthEmail" class="def">AuthEmail</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fromAuth" class="def">fromAuth</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:AuthEmail" class="caption collapser" onclick="toggleSection('i:AuthEmail')">Instances</p><div id="section.i:AuthEmail" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:AuthEmail">AuthEmail</a></span> <a href="src/AuthSite.html#line-141" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:ClearPassphrase" class="def">ClearPassphrase</a> <a href="src/AuthSite.html#ClearPassphrase" class="link">Source</a></p><div class="doc"><p>Sanity-preserving type</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ClearPassphrase" class="def">ClearPassphrase</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fromClear" class="def">fromClear</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:ClearPassphrase" class="caption collapser" onclick="toggleSection('i:ClearPassphrase')">Instances</p><div id="section.i:ClearPassphrase" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:ClearPassphrase">ClearPassphrase</a></span> <a href="src/AuthSite.html#line-144" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:6">Types</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:AuthMailMessage" class="def">AuthMailMessage</a> <a href="src/AuthSite.html#AuthMailMessage" class="link">Source</a></p><div class="doc"><p>The type of message you are expected to send.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:VerifyUserCreation" class="def">VerifyUserCreation</a> <a href="AuthSite.html#t:AuthToken">AuthToken</a></td><td class="doc"><p>A user is signing up</p></td></tr><tr><td class="src"><a name="v:VerifyPassReset" class="def">VerifyPassReset</a> <a href="AuthSite.html#t:AuthToken">AuthToken</a></td><td class="doc"><p>A user wants to reset their passphrase</p></td></tr><tr><td class="src"><a name="v:BadUserCreation" class="def">BadUserCreation</a></td><td class="doc"><p>A user tried to sign up with an existing address</p></td></tr><tr><td class="src"><a name="v:BadPassReset" class="def">BadPassReset</a></td><td class="doc"><p>A user tried to reset with an address that doesn't exist</p></td></tr></table></div><div class="subs instances"><p id="control.i:AuthMailMessage" class="caption collapser" onclick="toggleSection('i:AuthMailMessage')">Instances</p><div id="section.i:AuthMailMessage" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:AuthMailMessage">AuthMailMessage</a></span> <a href="src/AuthSite.html#line-138" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:AuthToken" class="def">AuthToken</a> <a href="src/AuthSite.html#AuthToken" class="link">Source</a></p><div class="doc"><p>A token used to confirm an email address.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AuthToken" class="def">AuthToken</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:fromAuthToken" class="def">fromAuthToken</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:AuthToken" class="caption collapser" onclick="toggleSection('i:AuthToken')">Instances</p><div id="section.i:AuthToken" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:AuthToken">AuthToken</a></span> <a href="src/AuthSite.html#line-126" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:7">Internals</h1><div class="top"><p class="src"><a name="v:provisional" class="def">provisional</a> :: <a href="AuthSite.html#t:Credentials">Credentials</a> -&gt; <a href="AuthSite.html#t:Verification">Verification</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> <a href="src/AuthSite.html#provisional" class="link">Source</a></p><div class="doc"><p>Generate a provisional user</p></div></div><div class="top"><p class="src"><a name="v:logout" class="def">logout</a> :: <a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> master =&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/AuthSite.html#logout" class="link">Source</a></p><div class="doc"><p>Log out by deleting the session var</p></div></div><div class="top"><p class="src"><a name="v:priviligedProvisionalUser" class="def">priviligedProvisionalUser</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:MonadIO">MonadIO</a> m =&gt; <a href="AuthSite.html#t:Credentials">Credentials</a> -&gt; <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlPersistT">SqlPersistT</a> m <a href="AuthSite.html#t:Verification">Verification</a> <a href="src/AuthSite.html#priviligedProvisionalUser" class="link">Source</a></p><div class="doc"><p>Store a provisional user for later verification. Returns the token to
 use for verification.</p></div></div><div class="top"><p class="src"><a name="v:privilegedCreateUser" class="def">privilegedCreateUser</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:MonadIO">MonadIO</a> m =&gt; <a href="AuthSite.html#t:VerifiedUser">VerifiedUser</a> -&gt; <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlPersistT">SqlPersistT</a> m () <a href="src/AuthSite.html#privilegedCreateUser" class="link">Source</a></p><div class="doc"><p>Insert a new user into the database.</p></div></div><div class="top"><p class="src"><a name="v:priviligedLogin" class="def">priviligedLogin</a> :: <a href="../yesod-core-1.4.20/Yesod-Core.html#t:Yesod">Yesod</a> master =&gt; <a href="AuthSite.html#t:AuthUser">AuthUser</a> -&gt; <a href="../yesod-core-1.4.20/Yesod-Core-Types.html#t:HandlerT">HandlerT</a> master <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/AuthSite.html#priviligedLogin" class="link">Source</a></p><div class="doc"><p>This privileged function must be used with care. It modifies the
 user's session; it's the difference between being logged in and not!</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:VerifiedUser" class="def">VerifiedUser</a> <a href="src/AuthSite.html#VerifiedUser" class="link">Source</a></p><div class="doc"><p>Internal</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:VerifiedUser" class="def">VerifiedUser</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:verifiedEmail" class="def">verifiedEmail</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:verifiedDigest" class="def">verifiedDigest</a> :: <a href="../basic-prelude-0.5.1/CorePrelude.html#t:ByteString">ByteString</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Verification" class="def">Verification</a> <a href="src/AuthSite.html#Verification" class="link">Source</a></p><div class="doc"><p>Internal</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Verification" class="def">Verification</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:verifyEmail" class="def">verifyEmail</a> :: <a href="AuthSite.html#t:AuthEmail">AuthEmail</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:verifyToken" class="def">verifyToken</a> :: <a href="AuthSite.html#t:AuthToken">AuthToken</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Verification" class="caption collapser" onclick="toggleSection('i:Verification')">Instances</p><div id="section.i:Verification" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:Verification">Verification</a></span> <a href="src/AuthSite.html#line-165" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h2 id="g:8"><code>persistent</code>-generated types</h2><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ProvisionalUser" class="def">ProvisionalUser</a> <a href="src/AuthSiteTypes.html#ProvisionalUser" class="link">Source</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ProvisionalUser" class="def">ProvisionalUser</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:provisionalUserEmail" class="def">provisionalUserEmail</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:provisionalUserDigest" class="def">provisionalUserDigest</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:ByteString">ByteString</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:provisionalUserToken" class="def">provisionalUserToken</a> :: !<a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:provisionalUserCreationTime" class="def">provisionalUserCreationTime</a> :: !<a href="../time-1.5.0.1/Data-Time-Clock.html#t:UTCTime">UTCTime</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:ProvisionalUser" class="caption collapser" onclick="toggleSection('i:ProvisionalUser')">Instances</p><div id="section.i:ProvisionalUser" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:PersistField">PersistField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:PersistEntity">PersistEntity</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:PersistFieldSql">PersistFieldSql</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:ToBackendKey">ToBackendKey</a> <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Ord.html#t:Ord">Ord</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Read.html#t:Read">Read</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../aeson-0.9.0.1/Data-Aeson-Types.html#t:ToJSON">ToJSON</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../aeson-0.9.0.1/Data-Aeson-Types.html#t:FromJSON">FromJSON</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:PersistField">PersistField</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../path-pieces-0.2.1/Web-PathPieces.html#t:PathPiece">PathPiece</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../http-api-data-0.2.2/Web-HttpApiData-Internal.html#t:ToHttpApiData">ToHttpApiData</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../http-api-data-0.2.2/Web-HttpApiData-Internal.html#t:FromHttpApiData">FromHttpApiData</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:PersistFieldSql">PersistFieldSql</a> (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>)</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:PersistEntityBackend">PersistEntityBackend</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> = <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> = <a name="v:ProvisionalUserKey" class="def">ProvisionalUserKey</a> {<ul class="inst"><li class="inst"><a name="v:unProvisionalUserKey" class="def">unProvisionalUserKey</a> :: <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:BackendKey">BackendKey</a> <a href="../persistent-2.2.4.1/Database-Persist-Sql.html#t:SqlBackend">SqlBackend</a></li></ul>}</span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> <span class="keyword">where</span><ul class="inst"><li class="inst"><a name="v:ProvisionalUserId" class="def">ProvisionalUserId</a> :: (~) * typ (<a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Key">Key</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a>) =&gt; <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> typ</li><li class="inst"><a name="v:ProvisionalUserEmail" class="def">ProvisionalUserEmail</a> :: (~) * typ <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a> =&gt; <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> typ</li><li class="inst"><a name="v:ProvisionalUserDigest" class="def">ProvisionalUserDigest</a> :: (~) * typ <a href="../basic-prelude-0.5.1/CorePrelude.html#t:ByteString">ByteString</a> =&gt; <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> typ</li><li class="inst"><a name="v:ProvisionalUserToken" class="def">ProvisionalUserToken</a> :: (~) * typ <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a> =&gt; <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> typ</li><li class="inst"><a name="v:ProvisionalUserCreationTime" class="def">ProvisionalUserCreationTime</a> :: (~) * typ <a href="../time-1.5.0.1/Data-Time-Clock.html#t:UTCTime">UTCTime</a> =&gt; <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:EntityField">EntityField</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> typ</li></ul></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">data</span> <a href="../persistent-2.2.4.1/Database-Persist-Class.html#t:Unique">Unique</a> <a href="AuthSite.html#t:ProvisionalUser">ProvisionalUser</a> <ul class="inst"><li class="inst">= <a name="v:UniqueProvisionalUser" class="def">UniqueProvisionalUser</a> <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li><li class="inst">| <a name="v:UniqueToken" class="def">UniqueToken</a> <a href="../basic-prelude-0.5.1/CorePrelude.html#t:Text">Text</a></li></ul></span> <a href="src/AuthSiteTypes.html#line-22" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>